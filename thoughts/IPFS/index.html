<!DOCTYPE html>
<html lang="en">



<head>
  
  <meta charset="UTF-8" />
  <meta
    name="description"
    content="IPFS is a decentralized storage and delivery network which builds on fundamental principles of [[thoughts/peer-to-peer|p2p]] networking and content-based addressing (see [[thoughts/CID|CID]])"
  />
  <title>
    IPFS
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  
  <meta property="og:url" content="https://jzhao.xyz" />
  <meta property="og:title" content="" />
  <meta property="og:description" content="" />
  <meta property="og:image" content="https://jzhao.xyz/res/og-card.png" />
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:creator" content="@_jzhao">
  <meta name="twitter:title" content="">
  <meta name="twitter:description" content="" />
  <meta name="twitter:image" content="https://jzhao.xyz/res/og-card.png" />


  
  
  
  
  
  <link rel="shortcut icon" type="image/png"  href="https://jzhao.xyz//icon.png" />
  

  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <link href="https://jzhao.xyz/styles.3f792f95b046b8a6c4dbf66a4412e3d0.min.css" rel="stylesheet" />

  
  <link href="https://jzhao.xyz/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css" rel="stylesheet" id="theme-link">

   
  
  
  
  
  <script src="https://jzhao.xyz/js/darkmode.f421222dbcb0e89bea7c9ed1d7659d3e.min.js"></script>
  
  
  
  <script src="https://jzhao.xyz/js/util.9825137f5e7825e8553c68ce39ac9e44.min.js"></script>
  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css" integrity="sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js" integrity="sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/copy-tex.min.js" integrity="sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A" crossorigin="anonymous"></script>


    
  <script src="https://unpkg.com/@floating-ui/core@0.7.3"></script>
  <script src="https://unpkg.com/@floating-ui/dom@0.5.4"></script>
  
  <script src="https://jzhao.xyz/js/popover.53ad9a087e3feeaaa12b63bfd02d923b.min.js"></script>

  
  
  
  <script src="https://jzhao.xyz/js/code-title.b35124ad8db0ba37162b886afb711cbc.min.js"></script>
  

  
  
  <script src="https://jzhao.xyz/js/clipboard.c20857734e53a3fb733b7443879efa61.min.js"></script>
  

  

  
   
  <script>
    
    const isReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches
    const lastVisit = localStorage.getItem('lastVisitTime')
    const now = Date.now()
    let show = 'true'
    if (lastVisit) {
      document.documentElement.setAttribute('visited', 'true')
      const minElapsed = Math.ceil((now - parseInt(lastVisit)) / (1000 * 60))
      show = (!isReducedMotion && minElapsed > 5) ? 'true' : 'false'
    }
    document.documentElement.setAttribute('show-animation', show)
    localStorage.setItem('lastVisitTime', `${now}`)

    const BASE_URL = "https://jzhao.xyz/"
    const fetchData = Promise.all([
          fetch("https:\/\/jzhao.xyz\/indices\/linkIndex.ca81da56c0668bba53b836d5ab3be111.min.json")
            .then(data => data.json())
            .then(data => ({
              index: data.index,
              links: data.links,
            })),
          fetch("https:\/\/jzhao.xyz\/indices\/contentIndex.ffa1192cc3e0358458645f9401b0f602.min.json")
            .then(data => data.json()),
        ])
        .then(([{index, links}, content]) => ({
          index,
          links,
          content,
        }))

      const render = () => {
      

      const siteBaseURL = new URL(BASE_URL);
      const pathBase = siteBaseURL.pathname;
      const pathWindow = window.location.pathname;
      const isHome = pathBase == pathWindow;

      addCopyButtons();
      

      addTitleToCodeBlocks();
      

      
     
      
      initPopover(
        "https://jzhao.xyz",
         true ,
         true 
      )
      

      
      const footer = document.getElementById("footer")
      if (footer) {
        const container = document.getElementById("graph-container")
        
        if (!container) return requestAnimationFrame(render)
        
        container.textContent = ""

        const drawGlobal = isHome &&  false ;
        drawGraph(
            "https://jzhao.xyz",
            drawGlobal,
            [{"/moc":"#4388cc"}],
            drawGlobal ? {"centerForce":1,"depth":-1,"enableDrag":true,"enableLegend":false,"enableZoom":true,"fontSize":0.5,"linkDistance":1,"opacityScale":3,"repelForce":1,"scale":1.4} : {"centerForce":1,"depth":1,"enableDrag":true,"enableLegend":false,"enableZoom":true,"fontSize":0.6,"linkDistance":0.8,"opacityScale":3,"repelForce":2,"scale":1}
          );

        }
      
    }

    const init = (doc = document) => {
      
      addCopyButtons();
      

      addTitleToCodeBlocks();
      renderMathInElement(doc.body, {
        delimiters: [
          {left: '$$', right: '$$', display: true},
          {left: '$', right: '$', display: false},
        ],
        macros: {
          '’': "'"
        },
        throwOnError : false
      });
      
    };
  </script>
  
  
  <script type="module">
    import { attachSPARouting } from "https:\/\/jzhao.xyz\/js\/router.9d4974281069e9ebb189f642ae1e3ca2.min.js"
    attachSPARouting(init, render)
  </script>
  
</head>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-WDD4K02HML"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-WDD4K02HML', { 'anonymize_ip': false });
}
</script>



<body>
<div id="search-container">
  <div id="search-space">
    <input autocomplete="off" id="search-bar" name="search" type="text" aria-label="Search"
      placeholder="Search for something..." dir="">
    <div id="results-container">
    </div>
  </div>
</div>


<script defer src="https://jzhao.xyz/js/semantic-search.9c4f636c1b2bfe1cfc3536d5e1d675f6.min.js"></script>



<div id="cursor-chat-layer">
  <input type="text" id="cursor-chat-box">
</div>
<script src="https://unpkg.com/cursor-chat"></script>

<div class="singlePage">
    
    <header class="delay t-3">
    <h1 id="page-title"><a href="https://jzhao.xyz/">jzhao.xyz</a></h1>
    <div class="spacer"></div>
    <div id="search-icon">
      <p>Search</p>
      <svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg>
    </div>
    <div class='darkmode'>
    <input class='toggle' id='darkmode-toggle' type='checkbox' tabindex="-1">
    <label id="toggle-label-light" for='darkmode-toggle' tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35;" xml:space="preserve">
            <title>Light Mode</title>
            <path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z" />
        </svg>
    </label>
    <label id="toggle-label-dark" for='darkmode-toggle' tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'" xml:space="preserve">
            <title>Dark Mode</title>
            <path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z" />
        </svg>
    </label>
</div>

</header>


    <article>
      <h1>IPFS</h1>
      <p class="meta">
        Last updated 
Jun 5, 2022

 
          
<a href="https://github.com/jackyzha0/jackyzha0.github.io/tree/hugo/content/thoughts/IPFS.md" rel="noopener">Edit Source</a>


      </p>
      <ul class="tags">
    
    <li><a href="https://jzhao.xyz/tags/seed/">Seed</a></li>
    
</ul>

      

      






  
  

  
  








  
  
  
    
  
    
  
  
    
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
        
        
        
      
    
  

  
  
  
    
  
    
  
  
    
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
        
        
        
      
    
  

  
  
  
    
  
    
  
  
    
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
        
        
        
      
    
  

  
  
  
    
  
    
  
  
    
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
        
        
        
      
    
  

  
  
  
    
  
    
  
  
    
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
        
        
        
      
    
  

  
  
  
    
  
    
  
  
    
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
        
        
        
      
    
  

  
  
  
    
  
    
  
  
    
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
        
        
        
      
    
  

  
  
  
    
  
    
  
  
    
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
        
        
        
      
    
  

  
  
  
    
  
    
  
  
    
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
        
        
        
      
    
  








<p>IPFS is a decentralized storage and delivery network which builds on fundamental principles of <a href="/thoughts/peer-to-peer" rel="noopener" class="internal-link" data-src="/thoughts/peer-to-peer">p2p</a> networking and content-based addressing (see <a href="/thoughts/CID" rel="noopener" class="internal-link" data-src="/thoughts/CID">CID</a>)</p>
<blockquote>
<p>Can seen as a single BitTorrent swarm, exchanging objects within one big Git repository</p>
</blockquote>
<p>Much like how we look up sites on the internet using URIs, we can look for specific pieces of content by their <a href="/thoughts/content-addressed-storage" rel="noopener" class="internal-link" data-src="/thoughts/content-addressed-storage">content-address</a>.</p>
<p>Under the hood, IPFS uses</p>
<ul>
<li>libp2p: network layer, takes care of host addressing, content and peer discovery, and structures like DHTs and pubsub</li>
<li>IPLD: data layer, standards and formats to build <a href="/thoughts/Merkle-DAG" rel="noopener" class="internal-link" data-src="/thoughts/Merkle-DAG">Merkle-DAG</a> structures (quasi-filesystem)</li>
<li>Multiformats: formatting structures for self-describing values</li>
</ul>
<p>Publishing content</p>
<ul>
<li>Chunk the content and deduplicate chunks</li>
<li>Obtain CID</li>
<li>Add the content to the network
<ul>
<li>Not the actual content, just the provider record to the <a href="/thoughts/DHT" rel="noopener" class="internal-link" data-src="/thoughts/DHT">DHT</a></li>
</ul>
</li>
</ul>
<p>Consuming content as a peer</p>
<ul>
<li>Get CID (out of band)</li>
<li>Using <a href="/thoughts/DHT" rel="noopener" class="internal-link" data-src="/thoughts/DHT">DHT</a>, resolve CID to peer</li>
<li>Contact peer to ask for CID content</li>
<li>Fetch content and cache a copy</li>
<li>Serve local copy upon subsequent request</li>
</ul>
<a href="#encodingdecoding"><h2 id="encodingdecoding"><span class="hanchor" ariaLabel="Anchor"># </span>Encoding/decoding</h2></a>
<p>How does the system decode the hashes that it gets into the component data structures?</p>
<p>Codecs! IPLD codecs are functions that transform IPLD Data Model into serialized bytes so you can send and share data, and transform serialized bytes back into IPLD Data Model so you can work with it. The <a href="/thoughts/CID" rel="noopener" class="internal-link" data-src="/thoughts/CID">CID</a> includes an indicator called a multicodec (opens new window)to tell us which codec to use!</p>
<p>Systems can build abstractions on top of this. For example, IPFS encodes the UnixFS using DAG-PB (which is a IPLD codec).</p>
<blockquote>
<p>Because the CID can describe different codecs relating to different systems, all sorts of systems can interoperate using CIDs, and IPLD and process and cross-link data from any of them.</p>
</blockquote>
<a href="#block-exchange-using-bitswap"><h2 id="block-exchange-using-bitswap"><span class="hanchor" ariaLabel="Anchor"># </span>Block Exchange using BitSwap</h2></a>
<p>BitSwap peers are looking to acquire a set of blocks (<code>want_list</code>), and have another set of blocks to offer in exchange (<code>have_list</code>). Unlike BitTorrent, BitSwap is not limited to the blocks in one torrent. BitSwap operates as a persistent marketplace where node can acquire the blocks they need, regardless of what files those blocks are part of. The blocks could come from completely unrelated files in the filesystem. Nodes come together to barter in the marketplace.</p>
<a href="#incentivizing-rare-blocks"><h3 id="incentivizing-rare-blocks"><span class="hanchor" ariaLabel="Anchor"># </span>Incentivizing rare blocks</h3></a>
<p>Of course, there will not be perfect overlaps between nodes&rsquo; <code>have_list</code> and <code>want_list</code>s . Nodes must work for their blocks. In the case that a node has nothing that its peers want (or nothing at all), it seeks the pieces its peers want, with lower priority than what the node wants itself. <strong>This incentivizes nodes to cache and disseminate rare pieces, even if they are not interested in them directly.</strong></p>
<p>This barter system implies a virtual currency could be created, this would require a global ledger to track ownership and transfer of the currency, which is exactly what <a href="/thoughts/Filecoin" rel="noopener" class="internal-link" data-src="/thoughts/Filecoin">Filecoin</a> provides.</p>
<a href="#incentivizing-satisfied-nodes-to-seed"><h3 id="incentivizing-satisfied-nodes-to-seed"><span class="hanchor" ariaLabel="Anchor"># </span>Incentivizing satisfied nodes to seed</h3></a>
<p>The protocol must also incentivize nodes to seed when they do not need anything in particular, as they might have the blocks others want. Thus, BitSwap nodes send blocks to their peers optimistically, expecting the debt to be repaid.</p>
<p>A simple credit-like system solves the problem:</p>
<ol>
<li>Peers track their balance (in bytes verified) with other nodes.</li>
<li>Peers send blocks to debtor peers probabilistically, according to a function that falls as debt increases. The probability function, given a debt ratio $r = \frac{\textrm{bytes sent}}{\textrm{bytes received} + 1}$ is $P(send | r) = 1 - \frac{1}{1 + \exp(6-3r)}$. The debt ratio is a measure of trust: lenient to debts between nodes that have previously exchanged lots of data successfully, and merciless to unknown, untrusted nodes. This also strongly disincentivizes Sybil attacks by making it hard for new nodes to request a lot of blocks without the intention of paying them back.</li>
</ol>
<a href="#pinning"><h2 id="pinning"><span class="hanchor" ariaLabel="Anchor"># </span>Pinning</h2></a>
<p>This ensures the objects are kept in the node’s local storage. Pinning can be done recursively, to pin down all linked descendent objects as well. All objects pointed to are then stored locally. This is particularly useful to persist files, including references</p>
<a href="#wnfs"><h2 id="wnfs"><span class="hanchor" ariaLabel="Anchor"># </span>WNFS</h2></a>
<p>Under the Fission project, 

<a href="https://guide.fission.codes/developers/webnative/file-system-wnfs" rel="noopener">see specs</a></p>
<p>File system built on top of IPFS. Uses a DAG instead of a hierarchy, meaning that a given child can have more than one parent.</p>
<p>Each user has their own WNFS and consists of a public and private tree.</p>
<ul>
<li>The public tree is &ldquo;live&rdquo; and publicly accessible on the Internet.</li>
<li>The private tree is encrypted so that only the owner can see the contents.</li>
</ul>
<p>Uses <a href="/thoughts/authorization#ucan" rel="noopener" class="internal-link" data-src="/thoughts/authorization">UCAN</a> for authorization.</p>


    </article>
    <hr/>


<div class="page-end" id="footer">
    <div class="backlinks-container">
        <h3>Backlinks</h3>
<ul class="backlinks">
    
    
    
    
    
    
    
    
    
      
      
      
    
      
      
      
    
      
      
      
    
      
      
      
    
      
      
      
    
      
      
      
    
      
      
      
    
      
      
      <li>
        <a href="/thoughts/Merkle-DAG/" data-ctx="IPFS" data-src="/thoughts/Merkle-DAG" class="internal-link">Merkle-DAG</a>
      </li>
      
      
      
      <li>
        <a href="/thoughts/OrbitDB/" data-ctx="IPFS" data-src="/thoughts/OrbitDB" class="internal-link">OrbitDB</a>
      </li>
      
      
      
      <li>
        <a href="/thoughts/Rhizome-Research-Log/" data-ctx="IPFS" data-src="/thoughts/Rhizome-Research-Log" class="internal-link">Rhizome Research Log</a>
      </li>
      
      
      
      <li>
        <a href="/thoughts/Sidetree/" data-ctx="IPFS" data-src="/thoughts/Sidetree" class="internal-link">Sidetree</a>
      </li>
      
      
      
      <li>
        <a href="/thoughts/content-addressed-storage/" data-ctx="IPFS" data-src="/thoughts/content-addressed-storage" class="internal-link">Content addressed storage</a>
      </li>
      
      
      
</ul>

    </div>
    <div>
        <script
  src="https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js"
  integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI="
  crossorigin="anonymous"
></script>
<h3>Interactive Graph</h3>
<div id="graph-container"></div>
<style>
  :root {
    --g-node: var(--secondary);
    --g-node-active: var(--primary);
    --g-node-inactive: var(--visited);
    --g-link: var(--outlinegray);
    --g-link-active: #5a7282;
  }
</style>

<script src="https://jzhao.xyz/js/graph.abd4bc2af3869a96524d7d23b76152c7.js"></script>

    </div>
</div>






<div id="contact_buttons">
    <footer>
        
        
        <p>Made by Jacky Zhao using <a href="https://github.com/jackyzha0/quartz">Quartz</a>, © 2022</p>
        <ul>
            
            <li><a href="https://jzhao.xyz/">Home</a></li>
            <li><a href="https://twitter.com/_jzhao">Twitter</a></li><li><a href="https://github.com/jackyzha0">Github</a></li></ul>
    </footer>
</div>


</div>
</body>
</html>
